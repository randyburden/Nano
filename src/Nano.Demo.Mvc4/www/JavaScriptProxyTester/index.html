<html>
<head>
    <title>JavaScript Proxy Tester</title>
    <script type="text/javascript">
        var ApiProxy = {
            /* This is a Nano auto-generated JavaScript client proxy created from the following url: http://localhost/Nano.Demo.Mvc4/ApiExplorer/?GenerateJavascriptProxy=True */
            baseApiUrl: location.href.substring(0, location.href.toLowerCase().indexOf('/javascriptproxytester')),

            postJson: function(url, data, onSuccessCallback, onErrorCallback) {

                var xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function() {
                    var readyState = xhr.readyState;

                    if (readyState === 4) {
                        if (xhr.status === 200) {
                            onSuccessCallback(JSON.parse(xhr.response), xhr);
                        } else {
                            if (onErrorCallback != null) {
                                onErrorCallback(xhr);
                            } else {
                                defaultErrorHandler(xhr);
                            }
                        }
                    }
                };

                var queryString = "";

                if (typeof data === "object" && data != null) {
                    for (var propertyName in data) {
                        if (data.hasOwnProperty(propertyName)) {
                            var value = data[propertyName];
                            if (typeof value === "object") {
                                value = JSON.stringify(value);
                            }
                            queryString += (queryString.length === 0 ? "" : "&") + propertyName + "=" + encodeURIComponent(value);
                        }
                    }
                }

                xhr.open("POST", url, true);
                xhr.setRequestHeader("content-type", "application/x-www-form-urlencoded");
                xhr.send(queryString);
            },

            defaultErrorHandler: function(xhr) {
                console.log(url + ". POST error: " + xhr.statusText);
            },

            customer: {
                createCustomer: function(firstName, lastName, onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="firstName" type="String">null</param>   
                    /// <param name="lastName" type="String">null</param>   
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = { firstName: firstName, lastName: lastName };
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/createcustomer", requestObject, onSuccessCallback, onErrorCallback);
                },

                getPerson: function(personId, onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="personId" type="Int32">null</param>   
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = { personId: personId };
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/getperson", requestObject, onSuccessCallback, onErrorCallback);
                },

                getCustomer: function(customerNbr, onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="customerNbr" type="Int32">null</param>   
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = { customerNbr: customerNbr };
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/getcustomer", requestObject, onSuccessCallback, onErrorCallback);
                },

                getContext: function(onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = {};
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/getcontext", requestObject, onSuccessCallback, onErrorCallback);
                },

                createPendingCustomer: function(firstName, lastName, onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="firstName" type="String">null</param>   
                    /// <param name="lastName" type="String">null</param>   
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = { firstName: firstName, lastName: lastName };
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/creatependingcustomer", requestObject, onSuccessCallback, onErrorCallback);
                },

                createDynamicCustomer: function(customer, onSuccessCallback, onErrorCallback) {
                    /// <summary>null</summary>
                    /// <param name="customer" type="Object">null</param>   
                    /// <param name="onSuccessCallback" type="Function">The callback function to receive your data.</param>
                    /// <param name="onErrorCallback" type="Function">The callback function to handle an error. </param>

                    var requestObject = { customer: customer };
                    ApiProxy.postJson(ApiProxy.baseApiUrl + "/api/customer/createdynamiccustomer", requestObject, onSuccessCallback, onErrorCallback);
                }
            }
        }
    </script>

    <script type="text/javascript">
        
        function callbackHandler(xhr) {
            console.log(xhr);

            var urlElement = document.createElement('h5');
            urlElement.innerText = xhr.responseURL;
            
            var responseStatusElement = document.createElement('pre');
            responseStatusElement.innerText = 'Response Status:' + xhr.status + ' ' + xhr.statusText;

            var responseBodyElement = document.createElement('pre');
            responseBodyElement.innerText = 'Response Body:\n\n' + xhr.responseText;

            var headersElement = document.createElement('pre');
            headersElement.innerText = 'Response Headers:\n\n' + xhr.getAllResponseHeaders();

            var wrapperElement = document.createElement('div');
            wrapperElement.appendChild(urlElement);
            wrapperElement.appendChild(responseStatusElement);
            wrapperElement.appendChild(responseBodyElement);
            wrapperElement.appendChild(headersElement);
            wrapperElement.appendChild(document.createElement('hr'));

            document.body.appendChild(wrapperElement);
        };

        function successCallback(data, xhr) {
            callbackHandler(xhr);
        };

        function errorCallback(xhr) {
            callbackHandler(xhr);
        };
    </script>

    <script type="text/javascript">
        ApiProxy.customer.createCustomer('Clark', 'Kent', successCallback, errorCallback);
        ApiProxy.customer.getPerson(300, successCallback, errorCallback);
        ApiProxy.customer.getCustomer(500, successCallback, errorCallback);
        ApiProxy.customer.getContext(successCallback, errorCallback);
        ApiProxy.customer.createPendingCustomer('Clark', 'Kent', successCallback, errorCallback);
        ApiProxy.customer.createDynamicCustomer({CustomerId: 1, FirstName: "Clark", LastName: "Kent"}, successCallback, errorCallback);
        ApiProxy.customer.createDynamicCustomer('{CustomerId: 1, FirstName: "Clark", LastName: "Kent"}', successCallback, errorCallback);
    </script>
</head>
<body>
</body>
</html>